<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Create and Account</title>
	<!--DO NOT FORGET THIS SCRIPT TAG SO YOU CAN USE JQUERY!!!!!-->
	<link rel="stylesheet" href="style1.css">
	<link rel="stylesheet" href="style2.css">
	<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Open+Sans'>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script>
		var accountsArray;
		var noRepeatedAccount;

		//resets the new account inputs
		function clearNewAccount() {
			$('#newLogonFName').val("");
			$('#newLogonLName').val("");
			$('#newLogonPassword').val("");
			$('#newLogonEmail').val("");
			$('#newLogonCompany').val();
			$('#newLogonYears').val();
			$('#mentorRadio').val();
			$('#menteeRadio').val();

		}

		//passes account info to the server, to create an account request
		function CreateAccount(fname, lname, pass, email, company, years) {

			var ele = document.getElementsByName('role');
			var role = "";

			for (i = 0; i < ele.length; i++) {
				if (ele[i].checked)
					role = ele[i].value;
			}

			var webMethod = "ProjectServices.asmx/StoreAccounts";
			$.ajax({
				type: "POST",
				url: webMethod,
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (msg) {
					if (msg.d.length > 0) {
						//let's put our accounts that we get from the
						//server into our accountsArray variable
						//so we can use them in other functions as well
						accountsArray = msg.d;
						noRepeatedAccount = false;

						for (var i = 0; i < accountsArray.length; i++) {
							// console.log(accountsArray[i]);
							if (accountsArray[i].email == email) {
								noRepeatedAccount = false;
								break;
							} else {
								noRepeatedAccount = true;
							}
						}
					} else {
						alert("loading accounts failed");
					}
					console.log(noRepeatedAccount);

					if (noRepeatedAccount) {
						webMethod = "ProjectServices.asmx/RequestAccount";
						parameters = "{\"pass\":\"" + encodeURI(pass) + "\",\"firstName\":\"" + encodeURI(fname) +
								      "\",\"lastName\":\"" + encodeURI(lname) + "\",\"email\":\"" + encodeURI(email) +
								      "\",\"company\":\"" + encodeURI(company) + "\",\"role\":\"" + encodeURI(role) + 
								      "\", \"year\":\"" + encodeURI(years) + "\"}";

						$.ajax({
							type: "POST",
							url: webMethod,
							data: parameters,
							contentType: "application/json; charset=utf-8",
							dataType: "json",
							success: function (msg) {
								window.open('index.html', '_self')
								clearNewAccount();
								alert("Account created!");
							},
							error: function (e) {
								alert("boo...");
							}
						})
					} else {
						alert('Account ID exists! Choose a new one.');
						clearNewAccount();
					};
				},
				error: function (e) {
					alert("boo...");
				}
			})
		};

		function changeVis(type) {
			if (type == 'mentor') {
				console.log(type);
				// console.log(document.getElementById('skillPropmt').innerHTML)
				document.getElementById('skillPrompt').innerHTML = '<br>What areas of expertise can you mentor in? <br>';
				document.getElementById('skillListSection').style.visibility = 'visible';
				document.getElementById('formButton').style.visibility = 'visible';
			} else {
				document.getElementById('skillPrompt').innerHTML = '<br>What areas would you like to be mentored in? <br>';
				document.getElementById('skillListSection').style.visibility = 'visible';
				document.getElementById('formButton').style.visibility = 'visible';
			}

			// change visibility of checkboxes and go button
		}
	</script>
	<style>
		#formButton,
		#skillListSection {
			visibility: hidden;
		}
	</style>

	<!--	<link href="styles.css" rel="stylesheet">-->

</head>

<body class ="w3-theme-l5">
	<div class="w3-top">
		<div class="w3-bar w3-theme-d2 w3-left-align w3-large">
		 <!-- <a class="w3-bar-item w3-button w3-hide-medium w3-hide-large w3-right w3-padding-large w3-hover-white w3-large w3-theme-d2" href="index.html" onclick="openNav()"><i class="fa fa-bars"></i></a>
		 <a href="#" class="w3-bar-item w3-button w3-padding-large w3-theme-d4"><i class="fa fa-home w3-margin-right"></i>Logo</a> -->
		 <a class="w3-bar-item w3-button w3-padding-small w3-theme-d4" id="leftAlign" href="index.html">Back to Log In</a>
		 <a class="w3-bar-item w3-button w3-padding-small w3-theme-d4" id="rightAlign" href="help.html">Help</a>
		 
		 <!-- <a href="#" class="w3-bar-item w3-button w3-hide-small w3-right w3-padding-large w3-hover-white" title="My Account">
		   <img src="/w3images/avatar2.png" class="w3-circle" style="height:23px;width:23px" alt="Avatar">
		 </a> -->
		</div>
	   </div>
	<header>
		<nav>
			<!-- <a id="leftAlign">New Account</a> -->
			<a class="navLink" id="leftAlign" href="index.html">Back to Log In</a>
			<a class="navLink" id="rightAlign" href="help.html">Help</a>
		</nav>
	</header>

	<main class="gradientBG">
		<h1>Create Your Account</h1>
		<h2>Fill out the form below to start you journey</h2>

		<form
			onsubmit="CreateAccount($('#newLogonFName').val(), $('#newLogonLName').val(), $('#newLogonPassword').val(), 
			$('#newLogonEmail').val(), $('#newLogonCompany').val(), $('#newLogonYears').val()); return false;">

			<section>
				<label>First Name</label><br />
				<input type="text" class="textInput" id="newLogonFName" name="fName" required /><br /><br />
			</section>

			<section>
				<label>Last Name</label><br />
				<input type="text" class="textInput" id="newLogonLName" name="lName" required /><br /><br />
			</section>
			
			<section>
				<label>Password</label><br />
				<input type="password" class="textInput" id="newLogonPassword" name="password" required /><br /><br />
			</section>

			<section>
				<label>Email</label><br />
				<input type="email" class="textInput" id="newLogonEmail" name="email" required /><br /><br />
			</section>

			<section>
				<label>Company</label><br />
				<input type="text" type="text" class="textInput" id="newLogonCompany" name="company"
					required /><br /><br />
			</section>

			<section>
				<label>Years Experience</label><br />
				<input type="number" step="1" min="0" max="70" id="newLogonYears" required /><br /><br />
			</section>

			<section>
<!--				<input type="radio" value="mentor" name="role" id="mentorRadio" onclick="changeVis('Mentor')" />-->
<!--				<label for="mentorRadio">Mentor</label>-->
<!--				<input type="radio" value="mentee" name="role" id="menteeRadio" onclick="changeVis('Mentee')" />-->
<!--				<label for="menteeRadio">Mentee</label>-->

				<input type="radio" value="mentor" name="role" id="mentorRadio" onclick="changeVis($('#mentorRadio').val())" />
				<label for="mentorRadio">Mentor</label>
				<input type="radio" value="mentee" name="role" id="menteeRadio" onclick="changeVis($('#menteeRadio').val())" />
				<label for="menteeRadio">Mentee</label>

				
			</section>

			<section id="skillListSection">
				<span id="skillPrompt">prompt</span>
				<input value="1" id="pythonCheck" type="checkbox">
				<label id="pythonLabel" for="pythonCheck">Python</label><br>
				<input value="2" id="javaCheck" type="checkbox">
				<label id="javaLabel" for="javaCheck">Java</label><br>
				<input value="3" id="sqlCheck" type="checkbox">
				<label id="sqlLabel" for="sqlCheck">SQL</label><br>
			</section>

			<br>
			<div>
				<!-- <button type="reset" class="button" id="formButton" value="Clear">Clear</button> -->
				<button class="button" id="formButton" type="submit">Go!</button>
			</div>

		</form>

	</main>
</body>

</html>